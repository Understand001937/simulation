<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ã‚«ã‚¸ãƒãƒãƒ¼ã‚«ãƒ¼å®Œå…¨ç‰ˆ</title>
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    background: #064420;
    color: white;
    font-family: sans-serif;
    text-align: center;
    overflow: hidden;
  }
  .hidden { display: none; }
  .btn {
    display: inline-block;
    padding: 8px 18px;
    margin: 6px;
    background: #d4af37;
    color: black;
    border-radius: 10px;
    font-size: 15px;
    cursor: pointer;
  }
  /* ç”»é¢ã‚µã‚¤ã‚ºï¼šiPadé¢¨ */
  .screen {
    width: 1024px;
    height: 768px;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    border: 4px solid #222;
    box-shadow: 0 0 30px rgba(0,0,0,0.8);
    background: #064420;
  }
  /* ã‚³ã‚¤ãƒ³è¡¨ç¤ºï¼ˆã‚²ãƒ¼ãƒ å…¨ä½“ã®é€šè²¨ï¼‰ */
  #coinDisplay {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(0,0,0,0.6);
    padding: 4px 10px;
    border-radius: 15px;
    border: 2px solid gold;
    color: gold;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 6px;
    z-index: 200;
  }
  .coinIcon {
    width: 18px;
    height: 18px;
    background: radial-gradient(circle, gold 40%, #b8860b 80%);
    border-radius: 50%;
    box-shadow: 0 0 10px gold;
  }
  /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
  #titleScreen {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  /* ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆéŠã³æ–¹ãƒ»ã‚·ãƒ§ãƒƒãƒ—ï¼‰ */
  .modal {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.9);
    border: 3px solid gold;
    border-radius: 15px;
    padding: 16px;
    width: 380px;
    max-width: 90%;
    z-index: 50;
    font-size: 13px;
  }
  .shopItem {
    background: #222;
    padding: 8px;
    margin: 6px 0;
    border-radius: 10px;
    border: 2px solid gold;
    text-align: left;
  }
  /* ã‚¿ãƒƒãƒ—ã‚¨ãƒªã‚¢ */
  #tapAreaScreen {
    background: #000;
  }
  #tapCoinImg {
    width: 150px;
    height: 150px;
    background: radial-gradient(circle, gold 40%, #b8860b 80%);
    border-radius: 50%;
    box-shadow: 0 0 30px gold;
    cursor: pointer;
    transition: transform 0.1s;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
  }
  .tapEffect {
    position: absolute;
    color: gold;
    font-size: 22px;
    animation: floatUp 0.8s ease-out forwards;
    pointer-events: none;
  }
  @keyframes floatUp {
    0% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-60px); }
  }
  /* ãƒãƒ¼ã‚«ãƒ¼ç”»é¢ */
  #pokerScreen {
    background: #064420;
  }
  /* ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå…¨è‰²å¯¾å¿œï¼‰ */
  #table {
    position: absolute;
    top: 50%; left: 50%;
    width: 780px;
    height: 500px;
    margin-left: -390px;
    margin-top: -250px;
    border: 12px solid #d4af37;
    border-radius: 50%;
    box-shadow: 0 0 30px rgba(0,0,0,0.7);
  }
  .table-green { background: #0a5a2c; }
  .table-black { background: #111; }
  .table-red { background: #7a1010; }
  .table-blue { background: #103a7a; }
  .table-purple { background: #4b1a6b; }
  .table-gold { background: #b8860b; }
  /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é…ç½® */
  .playerArea {
    position: absolute;
    width: 200px;
    text-align: center;
  }
  #cpu1 { top: 40px; left: 50%; margin-left: -100px; }
  #cpu2 { top: 170px; left: 80px; }
  #cpu3 { top: 170px; right: 80px; }
  #player { bottom: 90px; left: 50%; margin-left: -100px; }
  .nameLabel {
    margin-bottom: 4px;
    font-weight: bold;
    font-size: 13px;
  }
  .moneyLabel {
    font-size: 11px;
    margin-bottom: 2px;
  }
  .cardRow {
    display: flex;
    justify-content: center;
  }
  /* ã‚«ãƒ¼ãƒ‰ï¼ˆã‚¹ã‚­ãƒ³å¯¾å¿œï¼‰ */
  .card {
    width: 50px;
    height: 75px;
    background: white;
    border-radius: 8px;
    margin: 3px;
    line-height: 75px;
    font-size: 17px;
    color: black;
    box-shadow: 0 0 8px rgba(0,0,0,0.5);
    position: relative;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .card.back {
    background: #222;
    color: #222;
  }
  /* ã‚«ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ³ */
  .skin-red { background: #b00020; color: #fff; }
  .skin-blue { background: #0044aa; color: #fff; }
  .skin-black { background: #111; color: #fff; }
  .skin-gold { background: linear-gradient(135deg, #f7e27b, #c9a635); color: #000; }
  .skin-white { background: #f5f5f5; color: #000; }
  .skin-fire { background: linear-gradient(135deg, #ff9800, #b71c1c); color: #fff; }
  .skin-cyber { background: linear-gradient(135deg, #00e5ff, #1a237e); color: #fff; }
  .card.playerCard:hover {
    transform: translateY(-4px);
    box-shadow: 0 0 12px rgba(255,255,255,0.7);
    cursor: pointer;
  }
  .card.hold {
    border: 2px solid red;
    box-shadow: 0 0 15px red;
  }
  .dealAnim {
    animation: deal 0.25s ease-out;
  }
  @keyframes deal {
    0% { transform: translateY(-30px) scale(0.5); opacity: 0; }
    100% { transform: translateY(0) scale(1); opacity: 1; }
  }
  .glowAnim {
    animation: glow 1s infinite alternate;
  }
  @keyframes glow {
    0% { box-shadow: 0 0 4px rgba(255,255,255,0.3); }
    100% { box-shadow: 0 0 16px rgba(255,255,255,0.9); }
  }
  /* ãƒ†ã‚­ã‚µã‚¹ã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰ */
  #communityRow {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
  }
  /* ãƒãƒ¼ã‚«ãƒ¼æ“ä½œãƒœã‚¿ãƒ³ */
  #pokerControls {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 700px;
  }
  /* æƒ…å ±è¡¨ç¤º */
  #pokerInfo {
    position: absolute;
    top: 10px;
    left: 10px;
    text-align: left;
    font-size: 12px;
  }
  /* å‹åˆ©ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä¸­å¤®ã‚ˆã‚Šå°‘ã—ä¸Šï¼‰ */
  #pokerResult {
    position: absolute;
    top: 58%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 14px;
    white-space: pre-line;
    max-width: 80%;
  }
  /* CPUã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ï¼ˆæœ€å¤§3è¡Œï¼‰ */
  #actionLog {
    position: absolute;
    top: 42%;
    left: 50%;
    transform: translateX(-50%);
    width: 400px;
    font-size: 14px;
    text-align: center;
    white-space: pre-line;
  }
</style>
</head>
<body>
<!-- ã‚³ã‚¤ãƒ³è¡¨ç¤º -->
<div id="coinDisplay">
  <div class="coinIcon"></div>
  <span id="coinAmount">500</span>
</div>
<!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
<div id="titleScreen" class="screen">
  <h1>ğŸ° ã‚«ã‚¸ãƒãƒãƒ¼ã‚«ãƒ¼ ğŸ°</h1>
  <div class="btn" onclick="openHowTo()">éŠã³æ–¹</div>
  <div class="btn" onclick="openModeSelect()">ãƒãƒ¼ã‚«ãƒ¼ã‚’éŠã¶</div>
  <div class="btn" onclick="openShop()">ã‚·ãƒ§ãƒƒãƒ—</div>
  <div id="tapBtn" class="btn hidden" onclick="openTapArea()">ã‚¿ãƒƒãƒ—ã‚¨ãƒªã‚¢</div>
</div>
<!-- éŠã³æ–¹ -->
<div id="howToModal" class="modal hidden">
  <h2>éŠã³æ–¹</h2>
  <p>ãƒ»5ã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒ¼ ã¾ãŸã¯ ãƒ†ã‚­ã‚µã‚¹ãƒ›ãƒ¼ãƒ«ãƒ‡ãƒ ã‚’é¸ã‚“ã§éŠã³ã¾ã™ã€‚</p>
  <p>ãƒ»ã‚ãªãŸï¼‹CPU3äººã®4äººå¯¾æˆ¦ã§ã™ã€‚</p>
  <p>ãƒ»5ã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒ¼ï¼š5æšé…ã‚‰ã‚Œã€ãƒ›ãƒ¼ãƒ«ãƒ‰ã—ãŸã‚«ãƒ¼ãƒ‰ä»¥å¤–ã‚’1å›ã ã‘äº¤æ›ã§ãã¾ã™ã€‚</p>
  <p>ãƒ»ãƒ†ã‚­ã‚µã‚¹ãƒ›ãƒ¼ãƒ«ãƒ‡ãƒ ï¼š2æšã®æ‰‹æœ­ï¼‹å ´ã®5æšã‹ã‚‰æœ€å¼·ã®å½¹ã‚’ä½œã‚Šã¾ã™ã€‚</p>
  <p>ã€å½¹ä¸€è¦§ï¼ˆå¼·ã„é †ï¼‰ã€‘</p>
  <p>
    10. ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥<br>
    9. ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥<br>
    8. ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰<br>
    7. ãƒ•ãƒ«ãƒã‚¦ã‚¹<br>
    6. ãƒ•ãƒ©ãƒƒã‚·ãƒ¥<br>
    5. ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ<br>
    4. ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰<br>
    3. ãƒ„ãƒ¼ãƒšã‚¢<br>
    2. ãƒ¯ãƒ³ãƒšã‚¢<br>
    1. ãƒãƒ¼ãƒšã‚¢
  </p>
  <p>ãƒ»å‹ã¤ã¨ãƒãƒƒãƒˆåˆ†ã®ã‚³ã‚¤ãƒ³ãŒå¢—ãˆã¾ã™ã€‚CPUã‚‚ã‚³ã‚¤ãƒ³ã‚’æŒã£ã¦è³­ã‘ã¾ã™ã€‚</p>
  <div class="btn" onclick="closeHowTo()">é–‰ã˜ã‚‹</div>
</div>
<!-- ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
<div id="modeModal" class="modal hidden">
  <h2>ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠ</h2>
  <div class="btn" onclick="startPoker('draw')">5ã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒ¼</div>
  <div class="btn" onclick="startPoker('texas')">ãƒ†ã‚­ã‚µã‚¹ãƒ›ãƒ¼ãƒ«ãƒ‡ãƒ </div>
  <div class="btn" onclick="closeModeSelect()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</div>
</div>
<!-- ã‚·ãƒ§ãƒƒãƒ— -->
<div id="shopModal" class="modal hidden">
  <h2>ã‚·ãƒ§ãƒƒãƒ—</h2>
  <div class="shopItem">
    <strong>ã‚¿ãƒƒãƒ—ã‚¨ãƒªã‚¢è§£æ”¾</strong><br>
    ä¾¡æ ¼ï¼š500ã‚³ã‚¤ãƒ³
    <div class="btn" onclick="buyItem('tap')">è³¼å…¥</div>
  </div>
  <div class="shopItem">
    <strong>ã‚«ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ³</strong><br>
    èµ¤ / é’ / é»’ / é‡‘ / ç™½ / ç‚ / ã‚µã‚¤ãƒãƒ¼
    <div class="btn" onclick="buyItem('skin-red')">èµ¤ï¼ˆ200ï¼‰</div>
    <div class="btn" onclick="buyItem('skin-blue')">é’ï¼ˆ200ï¼‰</div>
    <div class="btn" onclick="buyItem('skin-black')">é»’ï¼ˆ200ï¼‰</div>
    <div class="btn" onclick="buyItem('skin-gold')">é‡‘ï¼ˆ300ï¼‰</div>
    <div class="btn" onclick="buyItem('skin-white')">ç™½ï¼ˆ200ï¼‰</div>
    <div class="btn" onclick="buyItem('skin-fire')">ç‚ï¼ˆ300ï¼‰</div>
    <div class="btn" onclick="buyItem('skin-cyber')">ã‚µã‚¤ãƒãƒ¼ï¼ˆ300ï¼‰</div>
  </div>
  <div class="shopItem">
    <strong>ãƒ†ãƒ¼ãƒ–ãƒ«ã‚«ãƒ©ãƒ¼</strong><br>
    ç·‘ / é»’ / èµ¤ / é’ / ç´« / é‡‘
    <div class="btn" onclick="buyItem('table-green')">ç·‘ï¼ˆ100ï¼‰</div>
    <div class="btn" onclick="buyItem('table-black')">é»’ï¼ˆ150ï¼‰</div>
    <div class="btn" onclick="buyItem('table-red')">èµ¤ï¼ˆ150ï¼‰</div>
    <div class="btn" onclick="buyItem('table-blue')">é’ï¼ˆ150ï¼‰</div>
    <div class="btn" onclick="buyItem('table-purple')">ç´«ï¼ˆ150ï¼‰</div>
    <div class="btn" onclick="buyItem('table-gold')">é‡‘ï¼ˆ200ï¼‰</div>
  </div>
  <div class="shopItem">
    <strong>ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–</strong><br>
    ã‚«ãƒ¼ãƒ‰ãŒå…‰ã‚‹æ¼”å‡ºãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚<br>
    ä¾¡æ ¼ï¼š400ã‚³ã‚¤ãƒ³
    <div class="btn" onclick="buyItem('anim')">è³¼å…¥</div>
  </div>
  <div class="btn" onclick="closeShop()">é–‰ã˜ã‚‹</div>
</div>
<!-- ã‚¿ãƒƒãƒ—ã‚¨ãƒªã‚¢ -->
<div id="tapAreaScreen" class="screen hidden">
  <div id="tapCoinImg" onclick="tapCoin()"></div>
  <div class="btn" style="position:absolute; bottom:20px; left:50%; transform:translateX(-50%);" onclick="closeTapArea()">æˆ»ã‚‹</div>
</div>
<!-- ãƒãƒ¼ã‚«ãƒ¼ç”»é¢ -->
<div id="pokerScreen" class="screen hidden">
  <div id="table" class="table-green"></div>
  <div id="pokerInfo">
    <div>ãƒ¢ãƒ¼ãƒ‰: <span id="modeLabel"></span></div>
    <div>ãƒãƒƒãƒˆ: <span id="potAmount">0</span></div>
    <div>ã‚ãªãŸã®ã‚³ã‚¤ãƒ³: <span id="playerMoneyLabel">0</span></div>
    <div>CPU1: <span id="cpu1MoneyLabel">0</span></div>
    <div>CPU2: <span id="cpu2MoneyLabel">0</span></div>
    <div>CPU3: <span id="cpu3MoneyLabel">0</span></div>
  </div>
  <!-- CPUã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚° -->
  <div id="actionLog"></div>
  <!-- ãƒ†ã‚­ã‚µã‚¹ã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰ -->
  <div id="communityRow"></div>
  <!-- CPU1 -->
  <div id="cpu1" class="playerArea">
    <div class="nameLabel">CPU1</div>
    <div class="moneyLabel" id="cpu1MoneySmall"></div>
    <div class="cardRow" id="cpu1Cards"></div>
  </div>
  <!-- CPU2 -->
  <div id="cpu2" class="playerArea">
    <div class="nameLabel">CPU2</div>
    <div class="moneyLabel" id="cpu2MoneySmall"></div>
    <div class="cardRow" id="cpu2Cards"></div>
  </div>
  <!-- CPU3 -->
  <div id="cpu3" class="playerArea">
    <div class="nameLabel">CPU3</div>
    <div class="moneyLabel" id="cpu3MoneySmall"></div>
    <div class="cardRow" id="cpu3Cards"></div>
  </div>
  <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
  <div id="player" class="playerArea">
    <div class="nameLabel">ã‚ãªãŸ</div>
    <div class="moneyLabel" id="playerMoneySmall"></div>
    <div class="cardRow" id="playerCards"></div>
  </div>
  <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
  <div id="pokerControls">
    <div class="btn" onclick="pokerCall()">ã‚³ãƒ¼ãƒ« / æ¬¡ã¸</div>
    <div class="btn" onclick="pokerRaise()">ãƒ¬ã‚¤ã‚º</div>
    <div class="btn" onclick="pokerFold()">ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰</div>
    <div id="drawBtn" class="btn" onclick="pokerDraw()">ã‚«ãƒ¼ãƒ‰äº¤æ›ï¼ˆãƒ‰ãƒ­ãƒ¼ã®ã¿ï¼‰</div>
    <div class="btn" onclick="backToTitleFromPoker()">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</div>
  </div>
  <!-- å‹åˆ©ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
  <div id="pokerResult"></div>
</div>
<script>
/* ============================
   â–¼ ã‚²ãƒ¼ãƒ å…¨ä½“ã®çŠ¶æ…‹
============================ */
let coins = 500;                 // ã‚²ãƒ¼ãƒ å…¨ä½“ã®é€šè²¨ï¼ˆã‚¿ãƒƒãƒ—ãƒ»ã‚·ãƒ§ãƒƒãƒ—ãƒ»ãƒãƒ¼ã‚«ãƒ¼å…±é€šï¼‰
let tapUnlocked = false;
let animUnlocked = false;
let selectedTableClass = 'table-green';
let selectedSkinClass = '';
let currentMode = 'draw';        // 'draw' or 'texas'
/* CPU ã¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰€æŒé‡‘ï¼ˆcoins ã¨åˆ¥ç®¡ç†ï¼‰ */
let playerMoney = 1000;
let cpu1Money = 1000;
let cpu2Money = 1000;
let cpu3Money = 1000;
/* ãƒãƒ¼ã‚«ãƒ¼ç”¨ */
const suits = ["â™ ", "â™¥", "â™¦", "â™£"];
const ranks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
let deck = [];
let playerHand = [];
let cpu1Hand = [];
let cpu2Hand = [];
let cpu3Hand = [];
let communityCards = [];
let holdFlags = [false, false, false, false, false];
let pot = 0;
let roundFinished = false;
let texasStage = 0;
/* CPU ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ï¼ˆæœ€å¤§3è¡Œï¼‰ */
let actionLog = [];
/* ============================
   â–¼ å…±é€š UI æ›´æ–°
============================ */
function showScreen(id) {
  document.getElementById("titleScreen").classList.add("hidden");
  document.getElementById("tapAreaScreen").classList.add("hidden");
  document.getElementById("pokerScreen").classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}
function updateCoins() {
  document.getElementById("coinAmount").textContent = coins;
}
function updateMoneyLabels() {
  document.getElementById("playerMoneyLabel").textContent = playerMoney;
  document.getElementById("cpu1MoneyLabel").textContent = cpu1Money;
  document.getElementById("cpu2MoneyLabel").textContent = cpu2Money;
  document.getElementById("cpu3MoneyLabel").textContent = cpu3Money;
  document.getElementById("playerMoneySmall").textContent = playerMoney + "ã‚³ã‚¤ãƒ³";
  document.getElementById("cpu1MoneySmall").textContent = cpu1Money + "ã‚³ã‚¤ãƒ³";
  document.getElementById("cpu2MoneySmall").textContent = cpu2Money + "ã‚³ã‚¤ãƒ³";
  document.getElementById("cpu3MoneySmall").textContent = cpu3Money + "ã‚³ã‚¤ãƒ³";
}
/* ============================
   â–¼ ãƒ¢ãƒ¼ãƒ€ãƒ«
============================ */
function openHowTo() { document.getElementById("howToModal").classList.remove("hidden"); }
function closeHowTo() { document.getElementById("howToModal").classList.add("hidden"); }
function openModeSelect() { document.getElementById("modeModal").classList.remove("hidden"); }
function closeModeSelect() { document.getElementById("modeModal").classList.add("hidden"); }
function openShop() { document.getElementById("shopModal").classList.remove("hidden"); }
function closeShop() { document.getElementById("shopModal").classList.add("hidden"); }
/* ============================
   â–¼ ã‚·ãƒ§ãƒƒãƒ—è³¼å…¥
============================ */
function buyItem(item) {
  let price = 0;
  if (item === "tap") price = 500;
  if (item === "skin-red" || item === "skin-blue" || item === "skin-black" || item === "skin-white") price = 200;
  if (item === "skin-gold" || item === "skin-fire" || item === "skin-cyber") price = 300;
  if (item.startsWith("table-")) {
    if (item === "table-green") price = 100;
    else if (item === "table-gold") price = 200;
    else price = 150;
  }
  if (item === "anim") price = 400;
  if (coins < price) {
    alert("ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šã¾ã›ã‚“ï¼");
    return;
  }
  coins -= price;
  updateCoins();
  if (item === "tap") {
    tapUnlocked = true;
    document.getElementById("tapBtn").classList.remove("hidden");
  } else if (item.startsWith("skin-")) {
    selectedSkinClass = item;
  } else if (item.startsWith("table-")) {
    const table = document.getElementById("table");
    table.classList.remove("table-green","table-black","table-red","table-blue","table-purple","table-gold");
    table.classList.add(item);
    selectedTableClass = item;
  } else if (item === "anim") {
    animUnlocked = true;
  }
  alert("è³¼å…¥ã—ã¾ã—ãŸï¼");
}
/* ============================
   â–¼ ã‚¿ãƒƒãƒ—ã‚¨ãƒªã‚¢
============================ */
function openTapArea() {
  if (!tapUnlocked) return;
  showScreen("tapAreaScreen");
}
function closeTapArea() {
  showScreen("titleScreen");
}
function tapCoin() {
  const gain = Math.floor(Math.random() * 5) + 1;
  coins += gain;
  updateCoins();
  const effect = document.createElement("div");
  effect.className = "tapEffect";
  effect.textContent = "+" + gain;
  const rect = document.getElementById("tapAreaScreen").getBoundingClientRect();
  effect.style.left = (rect.left + rect.width / 2 - 10) + "px";
  effect.style.top = (rect.top + rect.height / 2 - 40) + "px";
  document.body.appendChild(effect);
  setTimeout(() => effect.remove(), 800);
  const coin = document.getElementById("tapCoinImg");
  coin.style.transform = "translate(-50%, -50%) scale(0.9)";
  setTimeout(() => coin.style.transform = "translate(-50%, -50%) scale(1)", 100);
}
/* ============================
   â–¼ ãƒ‡ãƒƒã‚­ç”Ÿæˆ
============================ */
function createDeck() {
  const d = [];
  for (let s of suits) {
    for (let r of ranks) {
      d.push({ suit: s, rank: r });
    }
  }
  return d;
}
function shuffle(d) {
  for (let i = d.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [d[i], d[j]] = [d[j], d[i]];
  }
}
/* ============================
   â–¼ å½¹åˆ¤å®šï¼ˆ5æšï¼‰
============================ */
function rankValue(r) { return ranks.indexOf(r); }
function evaluate5(hand) {
  const counts = {};
  const suitsCount = {};
  const values = [];
  hand.forEach(card => {
    counts[card.rank] = (counts[card.rank] || 0) + 1;
    suitsCount[card.suit] = (suitsCount[card.suit] || 0) + 1;
    values.push(rankValue(card.rank));
  });
  values.sort((a,b)=>a-b);
  const isFlush = Object.values(suitsCount).includes(5);
  const isStraight =
    values.every((v,i)=> i===0 || v === values[i-1] + 1) ||
    JSON.stringify(values) === JSON.stringify([0,1,2,3,12]);
  const countValues = Object.values(counts);
  if (isStraight && isFlush && values.includes(12) && values.includes(11)) return {name:"ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥", rank:10};
  if (isStraight && isFlush) return {name:"ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥", rank:9};
  if (countValues.includes(4)) return {name:"ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰", rank:8};
  if (countValues.includes(3) && countValues.includes(2)) return {name:"ãƒ•ãƒ«ãƒã‚¦ã‚¹", rank:7};
  if (isFlush) return {name:"ãƒ•ãƒ©ãƒƒã‚·ãƒ¥", rank:6};
  if (isStraight) return {name:"ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ", rank:5};
  if (countValues.includes(3)) return {name:"ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰", rank:4};
  if (countValues.filter(v=>v===2).length === 2) return {name:"ãƒ„ãƒ¼ãƒšã‚¢", rank:3};
  if (countValues.includes(2)) return {name:"ãƒ¯ãƒ³ãƒšã‚¢", rank:2};
  return {name:"ãƒãƒ¼ãƒšã‚¢", rank:1};
}
/* ============================
   â–¼ ãƒ†ã‚­ã‚µã‚¹ï¼š7æšã‹ã‚‰æœ€å¼·å½¹
============================ */
function bestOf7(cards7) {
  const idx = [0,1,2,3,4,5,6];
  let best = {name:"ãƒãƒ¼ãƒšã‚¢", rank:1};
  function comb(start, chosen) {
    if (chosen.length === 5) {
      const hand = chosen.map(i => cards7[i]);
      const ev = evaluate5(hand);
      if (ev.rank > best.rank) best = ev;
      return;
    }
    for (let i = start; i < idx.length; i++) {
      chosen.push(idx[i]);
      comb(i+1, chosen);
      chosen.pop();
    }
  }
  comb(0, []);
  return best;
}
/* ============================
   â–¼ ãƒãƒ¼ã‚«ãƒ¼é–‹å§‹
============================ */
function startPoker(mode) {
  currentMode = mode;
  document.getElementById("modeLabel").textContent =
    mode === 'draw' ? '5ã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒ¼' : 'ãƒ†ã‚­ã‚µã‚¹ãƒ›ãƒ¼ãƒ«ãƒ‡ãƒ ';
  document.getElementById("modeModal").classList.add("hidden");
  showScreen("pokerScreen");
  startNewRound();
}
/* ============================
   â–¼ æ–°ã—ã„ãƒ©ã‚¦ãƒ³ãƒ‰
============================ */
function startNewRound() {
  deck = createDeck();
  shuffle(deck);
  playerHand = [];
  cpu1Hand = [];
  cpu2Hand = [];
  cpu3Hand = [];
  communityCards = [];
  holdFlags = [false,false,false,false,false];
  pot = 0;
  roundFinished = false;
  texasStage = 0;
  actionLog = [];
  updateActionLog();
  document.getElementById("pokerResult").textContent = "";
  document.getElementById("communityRow").innerHTML = "";
  const ante = 50;
  if (playerMoney < ante || cpu1Money < ante || cpu2Money < ante || cpu3Money < ante) {
    alert("èª°ã‹ã®ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šã¾ã›ã‚“ã€‚ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚Šã¾ã™ã€‚");
    backToTitleFromPoker();
    return;
  }
  playerMoney -= ante;
  cpu1Money -= ante;
  cpu2Money -= ante;
  cpu3Money -= ante;
  pot += ante * 4;
  document.getElementById("potAmount").textContent = pot;
  updateMoneyLabels();
  if (currentMode === 'draw') {
    playerHand = deck.splice(0,5);
    cpu1Hand = deck.splice(0,5);
    cpu2Hand = deck.splice(0,5);
    cpu3Hand = deck.splice(0,5);
    document.getElementById("drawBtn").style.display = "inline-block";
    renderHands(false);
  } else {
    playerHand = deck.splice(0,2);
    cpu1Hand = deck.splice(0,2);
    cpu2Hand = deck.splice(0,2);
    cpu3Hand = deck.splice(0,2);
    document.getElementById("drawBtn").style.display = "none";
    renderHands(false);
  }
}
/* ============================
   â–¼ æ‰‹æœ­æç”»
============================ */
function renderHands(showCPU) {
  renderHandTo("playerCards", playerHand, false, true);
  renderHandTo("cpu1Cards", cpu1Hand, !showCPU, false);
  renderHandTo("cpu2Cards", cpu2Hand, !showCPU, false);
  renderHandTo("cpu3Cards", cpu3Hand, !showCPU, false);
  if (currentMode === 'texas') {
    const row = document.getElementById("communityRow");
    row.innerHTML = "";
    communityCards.forEach(card => {
      const div = document.createElement("div");
      div.className = "card dealAnim";
      if (animUnlocked) div.classList.add("glowAnim");
      if (selectedSkinClass) div.classList.add(selectedSkinClass);
      div.textContent = card.suit + card.rank;
      row.appendChild(div);
    });
  }
}
function renderHandTo(elemId, hand, hide, isPlayer) {
  const row = document.getElementById(elemId);
  row.innerHTML = "";
  hand.forEach((card, idx) => {
    const div = document.createElement("div");
    div.className = "card dealAnim";
    if (animUnlocked) div.classList.add("glowAnim");
    if (selectedSkinClass && hide) div.classList.add(selectedSkinClass);
    if (hide) div.classList.add("back");
    if (isPlayer && currentMode === 'draw') {
      div.classList.add("playerCard");
      if (holdFlags[idx]) div.classList.add("hold");
      div.onclick = () => {
        if (roundFinished) return;
        holdFlags[idx] = !holdFlags[idx];
        renderHands(false);
      };
    }
    if (!hide) {
      if (selectedSkinClass) div.classList.add(selectedSkinClass);
      div.textContent = card.suit + card.rank;
    } else {
      div.textContent = "ğŸ‚ ";
    }
    row.appendChild(div);
  });
}
/* ============================
   â–¼ CPU ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°
============================ */
function updateActionLog() {
  const logBox = document.getElementById("actionLog");
  logBox.textContent = actionLog.join("\n");
}
function pushLog(text) {
  actionLog.push(text);
  if (actionLog.length > 3) actionLog.shift();
  updateActionLog();
}
/* ============================
   â–¼ CPU ãƒ™ãƒƒãƒˆåˆ¤æ–­
============================ */
function cpuBetDecision(evRank, money) {
  if (money <= 0) return 0;
  if (evRank >= 7) return 150;  // å¼·ã„ â†’ ãƒ¬ã‚¤ã‚º
  if (evRank >= 5) return 100;  // ãã“ãã“ â†’ ã‚³ãƒ¼ãƒ«
  if (evRank >= 3) return 50;   // å¼±ã‚ â†’ å°ã‚³ãƒ¼ãƒ«
  return Math.random() < 0.2 ? 50 : 0; // 20%ã§ã‚³ãƒ¼ãƒ«
}
/* ============================
   â–¼ CPU ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ™‚è¨ˆå›ã‚Šï¼‰
============================ */
function cpuAct(name, hand, moneyRef) {
  const ev = currentMode === 'draw'
    ? evaluate5(hand)
    : bestOf7(hand.concat(communityCards));
  const bet = cpuBetDecision(ev.rank, moneyRef.value);
  if (bet === 0) {
    pushLog(`${name} ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã—ãŸ`);
    return {action:"fold", bet:0};
  }
  moneyRef.value -= bet;
  pot += bet;
  document.getElementById("potAmount").textContent = pot;
  if (bet >= 100) {
    pushLog(`${name} ã¯ãƒ¬ã‚¤ã‚ºã—ãŸï¼ˆ+${bet}ï¼‰`);
    return {action:"raise", bet};
  } else {
    pushLog(`${name} ã¯ã‚³ãƒ¼ãƒ«ã—ãŸï¼ˆ+${bet}ï¼‰`);
    return {action:"call", bet};
  }
}
/* ============================
   â–¼ ã‚³ãƒ¼ãƒ«ï¼ˆã‚ãªãŸï¼‰
============================ */
function pokerCall() {
  if (roundFinished) {
    startNewRound();
    return;
  }
  pushLog("ã‚ãªãŸã¯ã‚³ãƒ¼ãƒ«ã—ãŸ");
  /* CPU1 â†’ CPU2 â†’ CPU3 */
  cpuAct("CPU1", cpu1Hand, {value: cpu1Money});
  cpuAct("CPU2", cpu2Hand, {value: cpu2Money});
  cpuAct("CPU3", cpu3Hand, {value: cpu3Money});
  updateMoneyLabels();
  if (currentMode === 'draw') {
    finishRound(false);
    return;
  }
  /* ãƒ†ã‚­ã‚µã‚¹ï¼šã‚¹ãƒ†ãƒ¼ã‚¸é€²è¡Œ */
  if (texasStage === 0) {
    communityCards = communityCards.concat(deck.splice(0,3));
    texasStage = 1;
    renderHands(false);
  } else if (texasStage === 1) {
    communityCards = communityCards.concat(deck.splice(0,1));
    texasStage = 2;
    renderHands(false);
  } else if (texasStage === 2) {
    communityCards = communityCards.concat(deck.splice(0,1));
    texasStage = 3;
    renderHands(false);
  } else if (texasStage === 3) {
    finishRound(true);
  }
}
/* ============================
   â–¼ ãƒ¬ã‚¤ã‚º
============================ */
function pokerRaise() {
  if (roundFinished) return;
  const raiseAmount = 100;
  if (playerMoney < raiseAmount) {
    alert("ã‚ãªãŸã®ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šã¾ã›ã‚“");
    return;
  }
  playerMoney -= raiseAmount;
  pot += raiseAmount;
  updateMoneyLabels();
  document.getElementById("potAmount").textContent = pot;
  pushLog(`ã‚ãªãŸã¯ãƒ¬ã‚¤ã‚ºã—ãŸï¼ˆ+${raiseAmount}ï¼‰`);
  /* CPU ã‚‚åå¿œ */
  cpuAct("CPU1", cpu1Hand, {value: cpu1Money});
  cpuAct("CPU2", cpu2Hand, {value: cpu2Money});
  cpuAct("CPU3", cpu3Hand, {value: cpu3Money});
  updateMoneyLabels();
}
/* ============================
   â–¼ ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰
============================ */
function pokerFold() {
  if (roundFinished) {
    startNewRound();
    return;
  }
  roundFinished = true;
  document.getElementById("pokerResult").textContent =
    "ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã—ã¾ã—ãŸã€‚\nCPUã®å‹ã¡ã€‚\nã‚³ã‚¤ãƒ³å¢—æ¸›: 0";
}
/* ============================
   â–¼ ãƒ‰ãƒ­ãƒ¼äº¤æ›ï¼ˆç¶šãï¼‰
============================ */
function pokerDraw() {
  if (roundFinished || currentMode !== 'draw') return;
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼äº¤æ›
  for (let i = 0; i < 5; i++) {
    if (!holdFlags[i]) {
      playerHand[i] = deck.shift();
    }
  }
  // CPUäº¤æ›ï¼ˆç°¡æ˜“AIï¼‰
  cpuDraw(cpu1Hand);
  cpuDraw(cpu2Hand);
  cpuDraw(cpu3Hand);
  finishRound(true);
}
/* CPUã®ãƒ‰ãƒ­ãƒ¼AIï¼ˆå¼±ã„æ‰‹ãªã‚‰2æšäº¤æ›ï¼‰ */
function cpuDraw(hand) {
  const ev = evaluate5(hand);
  if (ev.rank <= 1) {
    // ãƒ©ãƒ³ãƒ€ãƒ ã«2æšäº¤æ›
    hand[0] = deck.shift();
    hand[1] = deck.shift();
  }
}
/* ============================
   â–¼ ãƒ©ã‚¦ãƒ³ãƒ‰çµ‚äº†å‡¦ç†
============================ */
function finishRound(showAll) {
  roundFinished = true;
  // CPUã®æ‰‹æœ­ã‚’å…¬é–‹
  renderHands(true);
  let pEval, c1Eval, c2Eval, c3Eval;
  if (currentMode === 'draw') {
    pEval = evaluate5(playerHand);
    c1Eval = evaluate5(cpu1Hand);
    c2Eval = evaluate5(cpu2Hand);
    c3Eval = evaluate5(cpu3Hand);
  } else {
    pEval = bestOf7(playerHand.concat(communityCards));
    c1Eval = bestOf7(cpu1Hand.concat(communityCards));
    c2Eval = bestOf7(cpu2Hand.concat(communityCards));
    c3Eval = bestOf7(cpu3Hand.concat(communityCards));
  }
  const results = [
    {name:"ã‚ãªãŸ", eval:pEval},
    {name:"CPU1", eval:c1Eval},
    {name:"CPU2", eval:c2Eval},
    {name:"CPU3", eval:c3Eval},
  ];
  // å¼·ã„é †ã«ä¸¦ã¹ã‚‹
  results.sort((a,b)=>b.eval.rank - a.eval.rank);
  const top = results[0];
  const second = results[1];
  let msg =
    `ã‚ãªãŸ: ${pEval.name}\n` +
    `CPU1: ${c1Eval.name}\n` +
    `CPU2: ${c2Eval.name}\n` +
    `CPU3: ${c3Eval.name}\n\n`;
  let coinChange = 0;
  if (top.eval.rank === second.eval.rank) {
    msg += "çµæœ: å¼•ãåˆ†ã‘ï¼ãƒãƒƒãƒˆã¯å…¨å“¡ã«æˆ»ã‚Šã¾ã™ã€‚\n";
    const back = Math.floor(pot / 4);
    playerMoney += back;
    cpu1Money += back;
    cpu2Money += back;
    cpu3Money += back;
  } else {
    msg += `çµæœ: ${top.name} ã®å‹ã¡ï¼\n`;
    if (top.name === "ã‚ãªãŸ") {
      playerMoney += pot;
      coinChange = pot;
    } else if (top.name === "CPU1") {
      cpu1Money += pot;
    } else if (top.name === "CPU2") {
      cpu2Money += pot;
    } else if (top.name === "CPU3") {
      cpu3Money += pot;
    }
  }
  msg += `ã‚³ã‚¤ãƒ³å¢—æ¸›: +${coinChange}`;
  document.getElementById("pokerResult").textContent = msg;
  updateMoneyLabels();
}
/* ============================
   â–¼ ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹
============================ */
function backToTitleFromPoker() {
  showScreen("titleScreen");
}
/* ============================
   â–¼ åˆæœŸåŒ–
============================ */
updateCoins();
updateMoneyLabels();
</script>
</html>

